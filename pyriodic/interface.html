<!DOCTYPE html>
<!--suppress CssUnusedSymbol -->
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Pyriodic</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
		<style type="text/css">
			html, body {
				width:100%;
				height:100%;
				margin:0;
			}
			#sidebar {
				height:100%;
				width:100px;
				float:left;
				background-color:#0377E8;
			}
			#sidebar span, #sidebar h4 {
				float:left;
				clear:left;
				color:white;
				margin-left:6px;
			}
			#sidebar span {
				cursor:pointer;
			}
			#content {
				float:left;
				width:calc(100% - 100px);
				height:100%;
			}
			#content #jobs, #content h3 {
				margin-left:30px;
				margin-right:30px;
			}
			.job {
				margin-bottom:10px;
				padding-bottom:10px;
				border-bottom:1px solid #a5a5a5;
				min-height:40px;
			}
			.job:last-of-type {
				border-bottom:none;
			}
			.job div {
				float:left;
				margin-right:20px;
			}
			.job div span:first-of-type {
				margin-bottom:3px;
			}
			.job span {
				float:left;
				clear:left;
			}
			.jobName {
				font-weight:bold;
				min-width:50px;
			}
			.when {
				color:#0377E8;
				cursor:pointer;
			}
			span.run {
				cursor:pointer;
				color:#0377E8;
			}
			span.clear, span.pause, span.start {
				float:right;
				clear:right;
				font-size:small;
				position:relative;
				bottom:4px;
				cursor:pointer;
				color:#0377E8;
			}
		</style>
		<script type="text/javascript">
			$(function(){
				function load() {
					$.get('./jobs', function (html) {
						$('#jobs').html(html);
						jobbuttons();
					});
				}
				function jobbuttons() {
					$('.start').unbind('click').click(function () {
						$.ajax({
							url: './jobs/' + $(this).parent().data('job') + '/start',
							type: 'PUT'
						}).done(function(html) {
							$('#jobs').html(html);
							jobbuttons();
						});
					});
					$('.run').unbind('click').click(function () {
						$.ajax({
							url: './jobs/' + $(this).parent().parent().data('job') + '/run',
							type: 'PUT'
						}).done(function(html) {
							$('#jobs').html(html);
							jobbuttons();
						});
						setTimeout(function () {
							load();
						}, 500);
					});
					$('.pause').unbind('click').click(function () {
						$.ajax({
							url: './jobs/' + $(this).parent().data('job') + '/pause',
							type: 'PUT'
						}).done(function(html) {
							$('#jobs').html(html);
							jobbuttons();
						});
					});
					$('.clear').unbind('click').click(function () {
						$.ajax({
							url: './jobs/' + $(this).parent().data('job'),
							type: 'DELETE'
						}).done(function(html) {
							$('#jobs').html(html);
							jobbuttons();
						});
					});
					$('.when').unbind('click').click(function() {
						var text = $(this).html().replace('Interval: ', '');
						$(this).html('<button>Done</button><input type="text" value="'+ text + '" />');
						$(this).children().click(function(e) {
							e.stopPropagation();
						});
						$(this).find('button').click(function() {
							var val = $(this).next().val();
							var data = $(this).parents('.job').data('job');
							$(this).parent().html('Interval: ' + val);
							$.ajax({
								url: './jobs/' + data + '/when/' + val,
								type: 'PUT'
							}).done(function(html) {
								$('#jobs').html(html);
								jobbuttons();
							});
						});
					});
				}
				load();
				$('#start').click(function() {
					$.ajax({
						url: './jobs/all/start',
						type: 'PUT'
					}).done(function(html) {
						$('#jobs').html(html);
						jobbuttons();
					});
				});
				$('#pause').click(function() {
					$.ajax({
						url: './jobs/all/pause',
						type: 'PUT'
					}).done(function(html) {
						$('#jobs').html(html);
						jobbuttons();
					});
				});
				$('#clear').click(function() {
					$.ajax({
						url: './jobs',
						type: 'DELETE'
					}).done(function(html) {
						$('#jobs').html(html);
						jobbuttons();
					});
				});
			});
		</script>
	</head>
	<body>
		<div id="sidebar">
			<h4>Controll All</h4>
			<span id="start">Start</span>
			<span id="pause">Pause</span>
			<span id="clear">Clear</span>
		</div>
		<div id="content">
			<h3>Scheduled Jobs</h3>
			<div id="jobs"></div>
		</div>
	</body>
</html>